<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  {{- $noindex := .Params.noindex | default false -}}
  {{ if and (hugo.IsProduction) (not $noindex) -}}
    <meta name="robots" content="index, follow" />
  {{ else -}}
    <meta name="robots" content="noindex, nofollow" />
  {{ end -}}
  {{ partialCached "favicons.html" . -}}
  <title>
    {{- if .IsHome -}}
      {{ .Site.Title -}}
    {{ else -}}
      {{ with .Title }}{{ . }} â€“ {{ end -}}
      {{ .Site.Title -}}
    {{ end -}}
  </title>
  <meta name="description" content="{{ partial "utils/page-description.html" . }}" />

  {{- with .Params.canonical -}}
    <link rel="canonical" href="{{ . }}" itemprop="url" />
  {{- else -}}
    <link rel="canonical" href="{{ .Permalink }}" itemprop="url" />
  {{- end -}}

  {{- partial "opengraph.html" . -}}
  {{- partial "schema.html" . -}}
  {{- partial "twitter_cards.html" . -}}

  {{- /* Compiled Tailwind CSS from assets/css/compiled/main.css */ -}}
  {{- $compiledCss := resources.Get "css/compiled/main.css" -}}
  {{- if $compiledCss }}
    <link href="{{ $compiledCss.RelPermalink }}" rel="stylesheet" />
  {{- else }}
    <link href="/css/compiled/main.css" rel="stylesheet" />
  {{- end }}
  
  {{- /* Additional CSS files */ -}}
  {{- $variablesCss := resources.Get "css/variables.css" | resources.ExecuteAsTemplate "css/variables.css" . -}}
  {{- $customCss := resources.Get "css/custom.css" -}}
  <link href="{{ $variablesCss.RelPermalink }}" rel="stylesheet" />
  <link href="{{ $customCss.RelPermalink }}" rel="stylesheet" />

  {{ partial "components/analytics/analytics.html" . }}

  {{- $scriptsHead := slice -}}
  {{- range resources.Match "js/head/*.js" -}}
    {{ $scriptsHead = $scriptsHead | append (resources.ExecuteAsTemplate .Name $ .) }}
  {{- end -}}

  {{- $scripts := $scriptsHead | resources.Concat "js/main-head.js" -}}

  {{- if hugo.IsProduction -}}
  {{- $scripts = $scripts | minify | fingerprint -}}
  {{- end -}}
  <script src="{{ $scripts.RelPermalink }}" integrity="{{ $scripts.Data.Integrity }}"></script>

  <!-- Math engine -->
  {{ $noop := .WordCount -}}
  {{- $engine := site.Params.math.engine | default "katex" -}}
  {{ if and (.Page.Store.Get "hasMath") (eq $engine "katex") -}}
    {{ partialCached "scripts/katex.html" . -}}
  {{ else if and (.Page.Store.Get "hasMath") (eq $engine "mathjax") -}}
    {{ partialCached "scripts/mathjax.html" . -}}
  {{ end -}}

  {{ partial "utils/page-width-override.html" . }}
  {{ partial "custom/head-end.html" . -}}
</head>
